<h2><b>风控业务背景</b></h2><p>俗话说，路遥知马力，日久见人心。在风控中也是如此，我们常从时间维度提取借款人在不同时间点的特征，以此来判断借款人的风险。在实践中，这类特征通常会占到80%以上。由于是通过时间切片和聚合统计函数来构造，因此一般被称为时间滑窗统计特征。</p><p>本文的主要意义在于：</p><ul><li>对于需要入门风控建模的同学而言，希望能帮助你快速上手特征工程。</li><li>对已经有特征工程经验的同学而言，希望能带给你一些风控业务理解。</li></ul><blockquote><b>目录</b><br/>Part 1.  观察期、观察点及表现期<br/>Part 2.  RFM模型介绍<br/>Part 3.  时间滑窗<b>数量</b>统计类特征<br/>Part 4.  时间滑窗<b>占比</b>统计类特征<br/>Part 5.  时间滑窗<b>趋势</b>统计类特征<br/>Part 6.  时间滑窗<b>稳定性</b>衍生特征<br/>Part 7.  第三方多头借贷变量衍生<br/>Part 8.  总结<br/>致谢<br/>版权声明<br/>参考资料</blockquote><h2><b>Part 1.  观察期、观察点及表现期</b></h2><p>理解这三者的概念是风控建模前期样本准备的基础，在此简单介绍。</p><ul><li><b>观察点（</b>Observation Point<b>）</b>：并非是一个具体的时间点，而是一个时间区间，表示的是客户申请贷款的时间。在该时间段申请的客户<b>可能</b>会是我们用来建模的样本 。（提示：为什么用“可能”这个描述，因为还需剔除一些强规则命中的异常样本，这部分样本将不会加入建模）</li><li><b>观察期</b>（Observation Window）：用以<b>构造特征X</b>的时间窗口。相对于观察点而言，是<b>历史</b>时间。观察期的选择依赖于用户数据的厚薄程度。通常数据越厚，可提取的信息也就越全面、可靠。</li><li><b>表现期</b>（Performance Window）：定义<b>好坏标签Y</b>的时间窗口。相对于观察点而言，是<b>未来</b>时间。由于风险需要有一定时间窗才能表现出来，因此信贷风险具有<b>滞后性</b>。表现期的长短可以通过Vintage分析和滚动率分析来确定，在此不做展开。</li></ul><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-c47416a557f573a72acccb00ec5a37fe_b.jpg" data-size="normal" data-rawwidth="1512" data-rawheight="316" class="origin_image zh-lightbox-thumb" width="1512" data-original="https://pic3.zhimg.com/v2-c47416a557f573a72acccb00ec5a37fe_r.jpg"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1512&#39; height=&#39;316&#39;&gt;&lt;/svg&gt;" data-size="normal" data-rawwidth="1512" data-rawheight="316" class="origin_image zh-lightbox-thumb lazy" width="1512" data-original="https://pic3.zhimg.com/v2-c47416a557f573a72acccb00ec5a37fe_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-c47416a557f573a72acccb00ec5a37fe_b.jpg"/><figcaption>图 1 - 观察期、观察点及表现期</figcaption></figure><p>表现期越长，信用风险暴露将越彻底，但意味着观察期离当前将越远，用以提取样本特征的历史数据将越陈旧，建模样本和未来样本的差异也越大。反之，表现期越短，风险还未暴露完全，但好处是能用到更近的样本。</p><h2><b>Part 2.  RFM模型介绍</b></h2><p>RFM模型最早是用来衡量客户价值和客户创利能力。理解RFM框架的思想是构造统计类特征的基础，其含义为：</p><ul><li><b>R（Recency）</b>：客户最近一次交易消费时间的间隔。R值越大，表示客户交易发生的日期越久，反之则表示客户交易发生的日期越近。</li><li><b>F（Frequency）</b>：客户在最近一段时间内交易消费的次数。F值越大，表示客户交易越频繁，反之则表示客户交易不够活跃。</li><li><b>M（Monetary）</b>：客户在最近一段时间内交易消费的金额。M值越大，表示客户价值越高，反之则表示客户价值越低。</li></ul><h2><b>Part 3.  时间滑窗数量统计类特征</b></h2><p>对于不同数据源，我们可以统计得到不同内容的RFM特征。例如：</p><ul><li>运营商数据：用户每天的通话记录次数、时长等。</li><li>信用卡账单或电商交易数据：用户每天的交易笔数、金额等。</li><li>埋点行为数据：用户每天在某页面的浏览量、点击量等。</li><li>设备数据：用户每天的登陆、活跃次数。</li></ul><p>为了扩展更多的维度，我们常会维护一个分类名单库（或<b>分类指标体系</b>），可参考《<a href="https://zhuanlan.zhihu.com/p/77238851" class="internal">信贷风控中的名单库挖掘、使用和维护</a>》。接下来，我们就可以继续<b>细分类目</b>来统计。例如：</p><ul><li>信用卡交易数据：用户每天在母婴用品、交通出行、餐饮、美容美发等交易笔数、金额。</li><li>设备App数据：用户手机上安装的借贷类、生活类、运动类、音乐类等App的数量。</li></ul><p>以设备App数据为例，我们将统计得到如下数据：</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-e8569329967d9a0e5cccaa9302389c75_b.jpg" data-size="normal" data-rawwidth="2374" data-rawheight="544" class="origin_image zh-lightbox-thumb" width="2374" data-original="https://pic2.zhimg.com/v2-e8569329967d9a0e5cccaa9302389c75_r.jpg"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;2374&#39; height=&#39;544&#39;&gt;&lt;/svg&gt;" data-size="normal" data-rawwidth="2374" data-rawheight="544" class="origin_image zh-lightbox-thumb lazy" width="2374" data-original="https://pic2.zhimg.com/v2-e8569329967d9a0e5cccaa9302389c75_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-e8569329967d9a0e5cccaa9302389c75_b.jpg"/><figcaption>图 2 - 截止下单日，用户每天统计的App数量</figcaption></figure><p>需要指出的是，我们<b>需要结合业务去分析数据，数据因为业务才具有温度</b>。</p><p> <b>敲黑板划重点1——了解数据采集逻辑</b></p><p>特征是从原始数据中提取的信息，如果数据源采集上就存在问题，那么所构造的特征也必然有问题。</p><p>对于一些采集客观、可靠的数据源而言，分析过程就相对简单。例如，如果用户某天没有打电话，那么这天的通话次数为0，这是因为运营商客观保留了用户的原始数据。这时候，<b>0的含义就是用户在当天未有通话行为</b>。当然，对于用户借用他人手机打电话这种情况，则不在考虑范围内。</p><p>对于依赖于用户登陆、活跃行为才能采集到的数据，就更需要结合采集方式来分析。例如，在设备App数据中，如果某天统计得到用户安装的借贷类App为0。这个数字后面可能有哪些原因呢？可能的猜想有：</p><ul><li>1. <b>统计函数原理</b>：用户这一天并没有使用手机，导致数据采集上缺失。但SQL中count()函数在统计时会count(null) = 0，也就是说会将缺失值填充默认值为0。</li><li>2. <b>用户使用行为</b>：用户使用了<b>新安卓手机</b>，数据采集正常，但确实没安装借贷类App，因此用户维度统计值为0。或者，用户使用了<b>老安卓手机</b>，但主动卸载了所有借贷类App。</li><li>3. <b>数据采集技术</b>：用户使用了<b>苹果手机，</b>由于无法采集到App数据，哪怕手机上实际安装了借贷App，但统计值也为0。</li><li>4. <b>变量构造逻辑</b>：虽然手机上安装了借贷类App，但并不在你的借贷App名单库中，因此匹配数为0。</li></ul><p>那么到底是哪种原因呢？对于这些猜想，我们可以从以下维度加以佐证：</p><ul><li>用户当天是否活跃？</li><li>用户使用设备是否出现新的UMID（设备ID）？</li><li>用户使用设备的平台（iOS / Android）？</li><li>名单库是否很久没有维护？</li></ul><p>这也就是需要<b>结合业务经验对多个特征交叉衍生新特征</b>的原因，这种特征具有强业务含义，因此往往能发挥出更好的效果。</p><p> <b>敲黑板划重点2——定义观察期有效性</b></p><p>我们还需<b>考虑观察期的有效性，以及不同用户的数据厚薄程度</b>。</p><p>比如，如果一个用户手机号网龄才6个月，那么在统计最近6个月、12个月、24个月的通话记录次数时，可想而知这几个变量的数值都是一样的。</p><p>同理，对于手机号网龄分别是6个月的新用户和6年的老用户而言，“最近12个月的通话记录次数”这种特征是<b>不公平（unfair）</b>的。两者的<b>数据厚薄程度</b>不同，新用户的观察期实际上只有6个月，而老用户的观察期是12个月。</p><p>为了区分这种情况，有以下建议：</p><blockquote>1. <b>定义观察期有效性，</b>在时间滑窗统计时，更需要有意识地留出有效的观察期。<br/>2. <b>定义分群变量</b>。比如将数据有效期只有6个月和12个月的用户分成2个群体。</blockquote><h2><b>Part 4.  时间滑窗占比统计类特征</b></h2><p>在得到数量统计类特征后，我们继续衍生<b>占比（ratio）</b>类特征，一方面可用来<b>去除量纲影响</b>，另一方面<b>衡量用户的行为偏好</b>。例如：</p><blockquote>最近N个月内<b>母婴类</b>消费次数<b>占比</b> = 最近N个月内<b>母婴类</b>消费<b>次数</b> / 最近N个月内消费次数</blockquote><p>如果用户在某类消费次数或者金额占比上有明显的倾向，我们就更能掌握用户的消费行为偏好和其他属性。比如，如果用户的母婴类消费支出占比较大，说明用户是有娃一族，风险也就相对更低。</p><h2><b>Part 5.  时间滑窗趋势统计类特征</b></h2><p>由于一个人的行为是会动态变化的，衡量这种变化趋势对于风险识别也很重要。例如，对于借款人的多头借贷风险，如果多头指标呈现逐步上升的趋势，我们就觉得多头负债风险在上升。借款人往往会采取“拆东墙补西墙”的措施，如果哪一天连东墙都找不到拆，这个击鼓传花的游戏也就game over。</p><p>我们一般计算<b>斜率（slope）</b>来衡量这种变化趋势。例如：</p><blockquote>多头借贷趋势 =（当月的多头借贷次数 - 上个月的多头借贷次数）/  上个月的多头借贷次数</blockquote><h2><b>Part 6.  时间滑窗稳定性衍生特征</b></h2><p>在不同时间点统计的数量特征基础上，我们可以继续衡量用户行为的稳定性。</p><p>在数学上，我们通常可以用<b>变异系数（</b>Coefficient of Variation，CV<b>）</b>来衡量这种数据波动水平。变异系数越小，代表波动越小，稳定性越好。</p><blockquote>变异系数的计算公式为：变异系数 C·V =（ 标准偏差 SD / 平均值Mean ）× 100%</blockquote><p>例如，对于借贷次数，我们可以计算CV来衡量借贷行为的稳定性。</p><p>另外需要注意的是，对于持续多头借贷的老哥，其实风险并不会很高，因为有持续稳定的借贷渠道。但对于集中性爆发的多头借贷行为，我们就更需要加以关注。这背后的动机，可能是手头突然紧张（比如网赌输钱），可能是破罐子破摔，可能是前期潜伏突然爆发，可能是行业大环境影响。</p><h2><b>Part 7.  第三方多头借贷变量衍生</b></h2><p>据笔者所知，目前市场上所提供的第三方多头借贷数据通常包含以下变量：</p><blockquote>借款人最近7天、1个月、3个月、6个月、12个月、18个月、24个月的某类平台借贷次数<br/><br/>某类平台包含：消费金融公司、互联网金融公司、银行信贷、数据风控公司等等。</blockquote><p>根据这些原始变量，我们可以按照以上方法论衍生一些新变量。例如：</p><p>如果以“<b>最近7天的多头借贷次数 / 最近1个月的多头借贷次数</b>”，我们便可以判断借款人的时间维度上的借贷行为分布。这个变量数值越大，代表近期借贷集中，短期风险更大。</p><p>如果以“<b>最近1个月的银行信贷借贷次数 / 最近1个月的多头借贷次数</b>”，我们便可以判断借款人的在借贷平台维度的分布。这个变量数值越大，可以认为越趋于正面。</p><p>在使用这些变量时，我们还需考虑第三方数据公司所接入的机构数的变化。也就是说，如果接入机构数在持续增长，那么整体人群的多头借贷指数也可能往高分偏移。</p><h2><b>Part 8.  总结</b></h2><p>本文系统总结了时间滑窗统计特征的构造方法论，以及相应的业务理解。总的来说，我们先统计数量，再从占比、趋势、稳定性、集中性等维度去衍生。当然，最重要的一点还是多结合业务去思考。</p><h2><b>致谢</b></h2><p>感谢参考资料的作者带给我的启发。本文尚有理解不当之处，在此抛砖引玉。</p><h2><b>版权声明</b></h2><p> <b>欢迎转载分享</b>，<b>请在文章中注明作者和原文链接，感谢您对知识的尊重和对本文的肯定。</b></p><blockquote>原文作者：求是汪在路上（知乎ID） <br/>原文链接：<a href="https://zhuanlan.zhihu.com/p/85440355/" class="internal"><span class="invisible">https://</span><span class="visible">zhuanlan.zhihu.com/p/85</span><span class="invisible">440355/</span><span class="ellipsis"></span></a></blockquote><p>⚠️著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处，<b>侵权转载将追究相关责任</b>。</p><h2><b>参考资料</b></h2><a target="_blank" href="https://zhuanlan.zhihu.com/p/26177617" data-draft-node="block" data-draft-type="link-card" data-image="https://pic4.zhimg.com/v2-c9b24ed142e0733f6551107962e69813_180x120.jpg" data-image-width="1920" data-image-height="1080" class="LinkCard LinkCard--hasImage"><span class="LinkCard-backdrop" style="background-image:url(https://pic4.zhimg.com/v2-c9b24ed142e0733f6551107962e69813_180x120.jpg)"></span><span class="LinkCard-content"><span class="LinkCard-text"><span class="LinkCard-title" data-text="true">felix：JDATA京东算法大赛入门(score0.07+时间滑动窗口特征＋xgboost模型)</span><span class="LinkCard-meta"><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--InsertLink" fill="currentColor" viewBox="0 0 24 24" width="17" height="17"><path d="M6.77 17.23c-.905-.904-.94-2.333-.08-3.193l3.059-3.06-1.192-1.19-3.059 3.058c-1.489 1.489-1.427 3.954.138 5.519s4.03 1.627 5.519.138l3.059-3.059-1.192-1.192-3.059 3.06c-.86.86-2.289.824-3.193-.08zm3.016-8.673l1.192 1.192 3.059-3.06c.86-.86 2.289-.824 3.193.08.905.905.94 2.334.08 3.194l-3.059 3.06 1.192 1.19 3.059-3.058c1.489-1.489 1.427-3.954-.138-5.519s-4.03-1.627-5.519-.138L9.786 8.557zm-1.023 6.68c.33.33.863.343 1.177.029l5.34-5.34c.314-.314.3-.846-.03-1.176-.33-.33-.862-.344-1.176-.03l-5.34 5.34c-.314.314-.3.846.03 1.177z" fill-rule="evenodd"></path></svg></span>zhuanlan.zhihu.com</span></span><span class="LinkCard-imageCell"><img class="LinkCard-image LinkCard-image--horizontal" alt="图标" src="https://pic4.zhimg.com/v2-c9b24ed142e0733f6551107962e69813_180x120.jpg"/></span></span></a><a target="_blank" href="https://link.zhihu.com/?target=https%3A//www.douban.com/note/698611890/" data-draft-node="block" data-draft-type="link-card" class="LinkCard LinkCard--noImage"><span class="LinkCard-content"><span class="LinkCard-text"><span class="LinkCard-title" data-text="true">高阶用户运营 | 如何用RFM模型实现用户分层管理（附案例）|推荐收藏</span><span class="LinkCard-meta"><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--InsertLink" fill="currentColor" viewBox="0 0 24 24" width="17" height="17"><path d="M6.77 17.23c-.905-.904-.94-2.333-.08-3.193l3.059-3.06-1.192-1.19-3.059 3.058c-1.489 1.489-1.427 3.954.138 5.519s4.03 1.627 5.519.138l3.059-3.059-1.192-1.192-3.059 3.06c-.86.86-2.289.824-3.193-.08zm3.016-8.673l1.192 1.192 3.059-3.06c.86-.86 2.289-.824 3.193.08.905.905.94 2.334.08 3.194l-3.059 3.06 1.192 1.19 3.059-3.058c1.489-1.489 1.427-3.954-.138-5.519s-4.03-1.627-5.519-.138L9.786 8.557zm-1.023 6.68c.33.33.863.343 1.177.029l5.34-5.34c.314-.314.3-.846-.03-1.176-.33-.33-.862-.344-1.176-.03l-5.34 5.34c-.314.314-.3.846.03 1.177z" fill-rule="evenodd"></path></svg></span>www.douban.com</span></span><span class="LinkCard-imageCell"><div class="LinkCard-image LinkCard-image--default"><svg class="Zi Zi--Browser" fill="currentColor" viewBox="0 0 24 24" width="32" height="32"><path d="M11.991 3C7.023 3 3 7.032 3 12s4.023 9 8.991 9C16.968 21 21 16.968 21 12s-4.032-9-9.009-9zm6.237 5.4h-2.655a14.084 14.084 0 0 0-1.242-3.204A7.227 7.227 0 0 1 18.228 8.4zM12 4.836A12.678 12.678 0 0 1 13.719 8.4h-3.438A12.678 12.678 0 0 1 12 4.836zM5.034 13.8A7.418 7.418 0 0 1 4.8 12c0-.621.09-1.224.234-1.8h3.042A14.864 14.864 0 0 0 7.95 12c0 .612.054 1.206.126 1.8H5.034zm.738 1.8h2.655a14.084 14.084 0 0 0 1.242 3.204A7.188 7.188 0 0 1 5.772 15.6zm2.655-7.2H5.772a7.188 7.188 0 0 1 3.897-3.204c-.54.999-.954 2.079-1.242 3.204zM12 19.164a12.678 12.678 0 0 1-1.719-3.564h3.438A12.678 12.678 0 0 1 12 19.164zm2.106-5.364H9.894A13.242 13.242 0 0 1 9.75 12c0-.612.063-1.215.144-1.8h4.212c.081.585.144 1.188.144 1.8 0 .612-.063 1.206-.144 1.8zm.225 5.004c.54-.999.954-2.079 1.242-3.204h2.655a7.227 7.227 0 0 1-3.897 3.204zm1.593-5.004c.072-.594.126-1.188.126-1.8 0-.612-.054-1.206-.126-1.8h3.042c.144.576.234 1.179.234 1.8s-.09 1.224-.234 1.8h-3.042z"></path></svg></div></span></span></a><a target="_blank" href="https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s%3F__biz%3DMzU1NTMyOTI4Mw%3D%3D%26mid%3D2247487552%26idx%3D1%26sn%3D5bddfeb3040282d5a5dfb9510e34a699%26chksm%3Dfbd4a22ccca32b3a30f1d3345a905b0fa56e7eb78242ee2a86d6862e4a0c6576b3ff278f4369%26mpshare%3D1%26scene%3D1%26srcid%3D0514Z6Mp5NJGMpDdPvSSXzHu%26rd2werd%3D1%23wechat_redirect" data-draft-node="block" data-draft-type="link-card" data-image="https://pic4.zhimg.com/v2-f1967b3a09d99c0230cd7cf2d36981cf_180x120.jpg" data-image-width="862" data-image-height="366" class="LinkCard LinkCard--hasImage"><span class="LinkCard-backdrop" style="background-image:url(https://pic4.zhimg.com/v2-f1967b3a09d99c0230cd7cf2d36981cf_180x120.jpg)"></span><span class="LinkCard-content"><span class="LinkCard-text"><span class="LinkCard-title" data-text="true">「回顾」自动化特征工程和自动建模在风控场景的应用</span><span class="LinkCard-meta"><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--InsertLink" fill="currentColor" viewBox="0 0 24 24" width="17" height="17"><path d="M6.77 17.23c-.905-.904-.94-2.333-.08-3.193l3.059-3.06-1.192-1.19-3.059 3.058c-1.489 1.489-1.427 3.954.138 5.519s4.03 1.627 5.519.138l3.059-3.059-1.192-1.192-3.059 3.06c-.86.86-2.289.824-3.193-.08zm3.016-8.673l1.192 1.192 3.059-3.06c.86-.86 2.289-.824 3.193.08.905.905.94 2.334.08 3.194l-3.059 3.06 1.192 1.19 3.059-3.058c1.489-1.489 1.427-3.954-.138-5.519s-4.03-1.627-5.519-.138L9.786 8.557zm-1.023 6.68c.33.33.863.343 1.177.029l5.34-5.34c.314-.314.3-.846-.03-1.176-.33-.33-.862-.344-1.176-.03l-5.34 5.34c-.314.314-.3.846.03 1.177z" fill-rule="evenodd"></path></svg></span>mp.weixin.qq.com</span></span><span class="LinkCard-imageCell"><img class="LinkCard-image LinkCard-image--horizontal" alt="图标" src="https://pic4.zhimg.com/v2-f1967b3a09d99c0230cd7cf2d36981cf_180x120.jpg"/></span></span></a><hr/>

## References
[https://zhuanlan.zhihu.com/p/85440355](https://zhuanlan.zhihu.com/p/85440355)
