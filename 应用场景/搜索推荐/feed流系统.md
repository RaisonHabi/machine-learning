## 
### 摘要
Feed流是一个目前非常常见的功能，在众多产品中都有展现，通过Feed流可以把动态实时的传播给订阅者，是用户获取信息流的一种有效方式。

&nbsp;
### 概念
我们在讲如何设计Feed流系统之前，先来看一下Feed流中的一些概念：
#### Feed：
Feed流中的每一条状态或者消息都是Feed，比如朋友圈中的一个状态就是一个Feed，微博中的一条微博就是一个Feed。
#### Feed流：
持续更新并呈现给用户内容的信息流。每个人的朋友圈，微博关注页等等都是一个Feed流。
#### Timeline：
Timeline其实是一种Feed流的类型，微博，朋友圈都是Timeline类型的Feed流，但是由于Timeline类型出现最早，使用最广泛，最为人熟知，有时候也用Timeline来表示Feed流。
#### 关注页Timeline：
展示其他人Feed消息的页面，比如朋友圈，微博的首页等。
#### 个人页Timeline：
展示自己发送过的Feed消息的页面，比如微信中的相册，微博的个人页等。

&nbsp;
### 特征
Feed流系统有一些非常典型的特点，比如：
#### 多账号内容流：
Feed流系统中肯定会存在成千上万的账号，账号之间可以关注，取关，加好友和拉黑等操作。只要满足这一条，那么就可以当做Feed流系统来设计。
#### 非稳定的账号关系：
由于存在关注，取关等操作，所以系统中的用户之间的关系就会一直在变化，是一种非稳定的状态。
#### 读写比例100:1：
读写严重不平衡，读多写少，一般读写比例在10：1，甚至100：1以上。
#### 消息必达性要求高：
比如发送了一条朋友圈后，结果部分朋友看到了，部分朋友没看到，如果偏偏女朋友没看到，那么可能会产生很严重的感情矛盾，后果很严重。

上面的就是Feed流产品的一些特点，下面我们来看一下Feed流系统的分类。

&nbsp;
### 分类
Feed流的分类有很多种，但最常见的分类有两种：
#### Timeline：
按发布的时间顺序排序，先发布的先看到，后发布的排列在最顶端，类似于微信朋友圈，微博等。这也是一种最常见的形式。   
**产品如果选择Timeline类型，那么就是认为Feed流中的Feed不多，但是每个Feed都很重要，都需要用户看到**。
#### Rank：
按某个非时间的因子排序，一般是按照用户的喜好度排序，用户最喜欢的排在最前面，次喜欢的排在后面。   
**这种一般假定用户可能看到的Feed非常多，而用户花费在这里的时间有限，那么就为用户选择出用户最想看的Top N结果，场景的应用场景有图片分享、新闻推荐类、商品推荐等**。

上面两种是最典型，也是最常见的分类方式，另外的话，也有其他的分类标准，在其他的分类标准中的话，会多出两种类型：
#### Aggregate：
聚合类型，比如好几个朋友都看了同一场电影，这个就可以聚合为一条Feed：A，B，C看了电影《你的名字》，这种聚合功能比较适合在客户端做。  
一般的Aggregate类型是Timeline类型 + 客户端聚合。
#### Notice：
通知类型，这种其实已经是功能类型了，通知类型一般用于APP中的各种通知，私信等常见。这种也是Timeline类型，或者是Aggregate类型。

&nbsp;
## 实现
上面介绍了Feed流系统的概念，特征以及分类，接下来开始进入关键部分：如何实现一个千万级Feed流系统。

**由于系统中的所有用户不可能全部在线，且不可能同时刷新和发布Feed，那么一个能支撑千万量级Feed流的系统，其实在产品上可以支撑上亿的用户**。   
**如果要设计一个Feed流系统，最关键的两个核心，一个是存储，一个是推送**。
### 存储
我们先来看存储，Feed流系统中需要存储的内容分为两部分，一个是账号关系（比如关注列表），一种是Feed消息内容。   
不管是存储哪一种，都有几个问题需要考虑：
```
如何能支持100TB，甚至PB级数据量？
数据量大了后成本就很关键，成本如何能更便宜？
如何保证账号关系和Feed不丢失？
```
我们后面再解答这三个问题，先继续看推送
### 推送
推送系统需要的功能有两个，一个是发布Feed，一个是读取Feed流。  
对于提送系统，仍然有一些问题需要在选型之前考虑：
```
如何才能提供千万的TPS和QPS？
如何保证读写延迟在10ms，甚至2ms以下？
如何保证Feed的必达性？
```
再解答这些问题之前，我们先来大概了解下阿里云的表格存储TableStore。

### TableStore
表格存储(TableStore)是阿里云自主研发的专业级分布式NoSQL数据库，是基于共享存储的高性能、低成本、易扩展、全托管的半结构化数据存储平台，支撑互联网和物联网数据的高效计算与分析。

目前不管是阿里巴巴集团内部，还是外部公有云用户，都有成千上万的系统在使用。覆盖了重吞吐的离线应用，以及重稳定性，性能敏感的在线应用。目前使用的系统中，有些系统每秒写入行数超过3500万行，每秒流量超过5GB，单表总行数超过10万亿行，单表数据量超过10PB。

......




&nbsp;
## References
[如何打造千万级Feed流系统](https://juejin.im/post/6844903510744498190)   
[feed流推荐系统设计](https://blog.csdn.net/xwc35047/article/details/82996808)
