## 预训练语言模型在网易严选的应用
### 1.前言
文本的表征经历了漫长的发展历程，从最简单经典的bow词袋模型、以LDA为代表的主题模型、以word2vec为代表的稠密向量模型、到现在以Bert为代表的通用语言模型。  
词语是文本细粒度的表达，早期的预训练词向量虽简单易用，但无法解决一词多义的问题。  
近年来，基于大规模上下文语料，训练的通用语言模型，可以产出更细致的语义表征向量，相同的词在不同的语境中能抽取出不同的语义向量。

在通用常见的NLP任务中，数据标注是不能缺少的重要环节。数据的量级及质量会直接影响任务的效果。  
现实条件下，数据标注的成本往往很高，但好在我们拥有大量的无标注的语料。  
因此，**基于无监督的海量语料训练一个通用的语言模型，然后针对不同的NLP任务，进行少量数据标注后，再对模型进行微调成为了发展的趋势**。
### 2.模型结构(图片和公式详见参考)
<span style="color: rgb(0, 0, 0);font-family: 微软雅黑;font-size: 15px;letter-spacing: 0.544px;text-indent: 0pt;">我们选取最具代表性的三个语言模型: ELMO[1]、GPT[2]、BERT[3]&nbsp;进行对比，如下表所示。</span></p><p style="margin-top: 25px;margin-bottom: 25px;max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><img data-ratio="0.24551971326164876" data-src="https://mmbiz.qpic.cn/mmbiz_png/1OAQOBn95MgxnfCakwJfV2ouNictmwzVVLib8ovibQngJMj8KIt9WBPbMcHElodbO50iaQviaTbtt3ic3e12EcJTDoFQ/640?wx_fmt=png" data-type="png" data-w="558" style="color: rgb(85, 85, 85);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: border-box;vertical-align: top;border-style: none;line-height: 22.4px;margin-top: 4px;margin-bottom: 10px;cursor: zoom-in;width: 100%;height: auto;" data-backw="558" data-backh="137"  /></p><table><thead style="box-sizing: content-box;line-height: 22.4px;"><tr style="box-sizing: content-box;line-height: 22.4px;"><th style="box-sizing: content-box;text-align: center;line-height: 22.4px;padding-top: 6px;padding-right: 14px;padding-left: 12px;border-top: 0px;border-right-color: rgb(114, 119, 123);border-bottom-color: rgb(114, 119, 123);border-left-color: rgb(114, 119, 123);background-color: rgb(123, 129, 132);color: rgb(255, 255, 255);font-weight: 300;height: 32px;" width="69">语言模型</th><th style="box-sizing: content-box;text-align: center;line-height: 22.4px;padding-top: 6px;padding-right: 14px;padding-left: 12px;border-top: 0px;border-right-color: rgb(114, 119, 123);border-bottom-color: rgb(114, 119, 123);border-left-color: rgb(114, 119, 123);background-color: rgb(123, 129, 132);color: rgb(255, 255, 255);font-weight: 300;height: 32px;" width="126">Bert</th><th style="box-sizing: content-box;text-align: center;line-height: 22.4px;padding-top: 6px;padding-right: 14px;padding-left: 12px;border-top: 0px;border-right-color: rgb(114, 119, 123);border-bottom-color: rgb(114, 119, 123);border-left-color: rgb(114, 119, 123);background-color: rgb(123, 129, 132);color: rgb(255, 255, 255);font-weight: 300;height: 32px;">GPT</th><th style="box-sizing: content-box;text-align: center;line-height: 22.4px;padding-top: 6px;padding-right: 14px;padding-left: 12px;border-top: 0px;border-right-color: rgb(114, 119, 123);border-bottom-color: rgb(114, 119, 123);border-left-color: rgb(114, 119, 123);background-color: rgb(123, 129, 132);color: rgb(255, 255, 255);font-weight: 300;height: 32px;">EMLO</th></tr></thead><tbody style="box-sizing: content-box;line-height: 22.4px;"><tr style="box-sizing: content-box;line-height: 22.4px;"><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32" width="10">模型结构<br style="box-sizing: content-box;line-height: 20.8px;"  />(见上图)</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32" width="132">Transformer编码器</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32">Transformer解码器</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32">bi-lstm</td></tr><tr style="box-sizing: content-box;line-height: 22.4px;"><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32" width="10">目标任务</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32" width="138">(1) Masked LM<br style="box-sizing: content-box;line-height: 20.8px;"  />随机遮蔽的部分输入，进行预测<br style="box-sizing: content-box;line-height: 20.8px;"  />(2) Next sentence prediction<br style="box-sizing: content-box;line-height: 20.8px;"  />判断两个输入是否是上下文关系</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32">标准语言模型<br style="box-sizing: content-box;line-height: 20.8px;"  />前k个输入预测第 k + 1个输入</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32">双向语言模型<br style="box-sizing: content-box;line-height: 20.8px;"  />(1) 前k个输入预测第 k + 1个输入<br style="box-sizing: content-box;line-height: 20.8px;"  />(2)后k个输入预测倒数第 k + 1个输入</td></tr><tr style="box-sizing: content-box;line-height: 22.4px;"><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32" width="10">推荐使用方式</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32" width="144">微调</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32">微调</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32">特征集成</td></tr><tr style="box-sizing: content-box;line-height: 22.4px;"><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32" width="10">优缺点</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32" width="150">双向语言模型<br style="box-sizing: content-box;line-height: 20.8px;"  />Transformer抽取能力强</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32">单向语言模型</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32">lstm特征抽取能力弱<br style="box-sizing: content-box;line-height: 20.8px;"  />训练速度慢</td></tr></tbody></table><p style="margin-top: 25px;margin-bottom: 25px;max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="color: rgb(0, 0, 0);font-family: 微软雅黑;font-size: 15px;letter-spacing: 0.544px;text-indent: 0pt;">ELMO采用的lstm网络，而gpt和BERT采用的网络结构都是transformer。Transformer是谷歌17年的文章《attention is all you need》[4]中提出的一种自注意力机制，替代传统的RNN和CNN进行语义特征的抽取，在机器翻译上取得了优异的效果。</span></p><p style="margin-top: 25px;margin-bottom: 25px;max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><img data-ratio="0.6248736097067745" data-src="https://mmbiz.qpic.cn/mmbiz_png/1OAQOBn95MgxnfCakwJfV2ouNictmwzVVnvf4pic8Gyia3sao49YcCxhFx9omVS53urYZBAUOomXuFI8xibKiaZ0KJA/640?wx_fmt=png" data-type="png" data-w="989" style="box-sizing: border-box;vertical-align: top;border-style: none;line-height: 22.4px;margin-top: 4px;margin-bottom: 10px;cursor: zoom-in;width: 100%;height: auto;" data-backw="578" data-backh="361"  /></p><p style="margin-top: 25px;margin-bottom: 25px;max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="color: rgb(0, 0, 0);font-family: 微软雅黑;font-size: 15px;letter-spacing: 0.544px;text-indent: 0pt;">Transformer 采用的是标准的seq2seq的模式&nbsp;( 上左图所示 )，其中关键的特征抽取部分采用的是多抽头的自注意力机制 ( 上右上图所示 )。所谓的多抽头是指多个自注意力机制并行，最终拼接成输出的过程。注意力机制采用的是点乘注意力 ( 上右下图所示 )。</span></p><p style="margin-top: 25px;margin-bottom: 25px;max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="color: rgb(0, 0, 0);font-family: 微软雅黑;font-size: 15px;letter-spacing: 0.544px;text-indent: 0pt;">点乘注意力机制的主要有下面四个步骤：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li style="color: rgb(136, 136, 136);"><p style="max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;margin-top: 10px;margin-bottom: 10px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;color: rgb(136, 136, 136);">query 到&nbsp;( key , value ) 的映射</span></p></li><li style="color: rgb(136, 136, 136);"><p style="max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;margin-top: 10px;margin-bottom: 10px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;color: rgb(136, 136, 136);">计算query与每个key之间的权重</span></p></li><li style="color: rgb(136, 136, 136);"><p style="max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;margin-top: 10px;margin-bottom: 10px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;color: rgb(136, 136, 136);">softmax函数权重归一化</span></p></li><li style="color: rgb(136, 136, 136);"><p style="max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;margin-top: 10px;margin-bottom: 10px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;color: rgb(136, 136, 136);">权重和value进行加权求和</span></p></li></ul><p style="margin-top: 25px;margin-bottom: 25px;max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="color: rgb(0, 0, 0);font-family: 微软雅黑;font-size: 15px;letter-spacing: 0.544px;text-indent: 0pt;">自注意力就是Q,K,V均相同，均为输入</span></p><p style="margin-top: 25px;margin-bottom: 25px;max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><img data-ratio="0.16442048517520216" data-src="https://mmbiz.qpic.cn/mmbiz_png/1OAQOBn95MgxnfCakwJfV2ouNictmwzVVQBauUVcVmyOMqC878VXjkIpyJ4Iv8bTiazKHq7nJTu6qo0IkUJUbm9w/640?wx_fmt=png" data-type="png" data-w="371" style="box-sizing: border-box;vertical-align: top;border-style: none;line-height: 22.4px;margin-top: 4px;margin-bottom: 10px;cursor: zoom-in;width: 250px;height: 41px;"  /></p><p style="margin-top: 25px;margin-bottom: 25px;max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="color: rgb(0, 0, 0);font-family: 微软雅黑;font-size: 15px;letter-spacing: 0.544px;text-indent: 0pt;">将RNN CNN Transformer三种常见的特征抽取方式的比较汇总于下表。</span></p><table width="NaN"><thead style="box-sizing: content-box;line-height: 22.4px;"><tr style="box-sizing: content-box;line-height: 22.4px;"><th style="box-sizing: content-box;text-align: center;line-height: 22.4px;padding-top: 6px;padding-right: 14px;padding-left: 12px;border-top: 0px;border-right-color: rgb(114, 119, 123);border-bottom-color: rgb(114, 119, 123);border-left-color: rgb(114, 119, 123);background-color: rgb(123, 129, 132);color: rgb(255, 255, 255);font-weight: 300;height: 32px;">模型结构</th><th style="box-sizing: content-box;text-align: center;line-height: 22.4px;padding-top: 6px;padding-right: 14px;padding-left: 12px;border-top: 0px;border-right-color: rgb(114, 119, 123);border-bottom-color: rgb(114, 119, 123);border-left-color: rgb(114, 119, 123);background-color: rgb(123, 129, 132);color: rgb(255, 255, 255);font-weight: 300;height: 32px;">RNN</th><th style="box-sizing: content-box;text-align: center;line-height: 22.4px;padding-top: 6px;padding-right: 14px;padding-left: 12px;border-top: 0px;border-right-color: rgb(114, 119, 123);border-bottom-color: rgb(114, 119, 123);border-left-color: rgb(114, 119, 123);background-color: rgb(123, 129, 132);color: rgb(255, 255, 255);font-weight: 300;height: 32px;">CNN</th><th style="box-sizing: content-box;text-align: center;line-height: 22.4px;padding-top: 6px;padding-right: 14px;padding-left: 12px;border-top: 0px;border-right-color: rgb(114, 119, 123);border-bottom-color: rgb(114, 119, 123);border-left-color: rgb(114, 119, 123);background-color: rgb(123, 129, 132);color: rgb(255, 255, 255);font-weight: 300;height: 32px;">Transformer</th></tr></thead><tbody style="box-sizing: content-box;line-height: 22.4px;"><tr style="box-sizing: content-box;line-height: 22.4px;"><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32">时间复杂度</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32">O(N)<br style="box-sizing: content-box;line-height: 20.8px;"  />句子长度为N</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32">O(N/k)<br style="box-sizing: content-box;line-height: 20.8px;"  />k为卷积核宽度</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32">O(1)</td></tr><tr style="box-sizing: content-box;line-height: 22.4px;"><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32">非线性次数</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32">不一</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32">恒定</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32">恒定</td></tr><tr style="box-sizing: content-box;line-height: 22.4px;"><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32">参数数量</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32">较少</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32">较多</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32">较多</td></tr><tr style="box-sizing: content-box;line-height: 22.4px;"><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32">优劣</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32">表示能力不足，损失严重</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32">dependency范围有限<br style="box-sizing: content-box;line-height: 20.8px;"  />1 + a(k-1）a为卷积次数</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32">一层实现输入序列上的 long-range dependencies</td></tr></tbody></table><h2 data-anchor="2-使用方式" style="margin-top: 25px;max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;text-align: center;margin-bottom: 5px;box-sizing: border-box !important;overflow-wrap: break-word !important;">

### 3.使用方式
<span style="font-size: 15px;color: rgb(0, 128, 255);"><strong><span style="color: rgb(0, 128, 255);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">1. 应用模式</span></strong></span></h2><h2 data-anchor="2-使用方式" style="margin-top: 25px;margin-bottom: 25px;max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="color: rgb(0, 0, 0);font-family: 微软雅黑;font-size: 15px;letter-spacing: 0.544px;text-indent: 0pt;">将预训练的语言模型运用到新的NLP任务上去时，有下面两种应用模式。</span></h2><table><thead style="box-sizing: content-box;line-height: 22.4px;"><tr style="box-sizing: content-box;line-height: 22.4px;"><th style="box-sizing: content-box;text-align: center;line-height: 22.4px;padding-top: 6px;padding-right: 14px;padding-left: 12px;border-top: 0px;border-right-color: rgb(114, 119, 123);border-bottom-color: rgb(114, 119, 123);border-left-color: rgb(114, 119, 123);background-color: rgb(123, 129, 132);color: rgb(255, 255, 255);font-weight: 300;height: 32px;" width="114">应用模式</th><th style="box-sizing: content-box;text-align: center;line-height: 22.4px;padding-top: 6px;padding-right: 14px;padding-left: 12px;border-top: 0px;border-right-color: rgb(114, 119, 123);border-bottom-color: rgb(114, 119, 123);border-left-color: rgb(114, 119, 123);background-color: rgb(123, 129, 132);color: rgb(255, 255, 255);font-weight: 300;height: 32px;" width="413"><br  /></th></tr></thead><tbody style="box-sizing: content-box;line-height: 22.4px;"><tr style="box-sizing: content-box;line-height: 22.4px;"><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32" width="36">特征集成<br style="box-sizing: content-box;line-height: 20.8px;"  />(Feature Ensemble)</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32" width="413">要判断的输入句子,经过预训练的语言模型，获取对应单词的embedding，输入到下游任务的模型上去。</td></tr><tr style="box-sizing: content-box;line-height: 22.4px;"><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32" width="36">微调<br style="box-sizing: content-box;line-height: 20.8px;"  />（Fine-tuning）</td><td style="box-sizing: content-box;line-height: 20.8px;font-size: 13px;padding-right: 14px;padding-left: 12px;border-color: rgb(234, 234, 234);" height="32" width="413">仍然采用与预训练过程相同的网络结构，利用部分标注数据，直接在这个网络上进行模型训练，以针对性地修正预训练阶段获得的网络参数。</td></tr></tbody></table><p style="margin-top: 25px;margin-bottom: 25px;max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="color: rgb(0, 0, 0);font-family: 微软雅黑;font-size: 15px;letter-spacing: 0.544px;text-indent: 0pt;">按理来说，各种语言模型均可以采用这两种使用方式，那么该如何选择，有研究[5][6][7]中给出了下面的结论：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li style="color: rgb(136, 136, 136);"><p style="max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;margin-top: 10px;margin-bottom: 10px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;color: rgb(136, 136, 136);">ELMO来说，特征集成的应用方式，效果稳定地优于Fine-tuning；</span></p></li><li style="color: rgb(136, 136, 136);"><p style="max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;margin-top: 10px;margin-bottom: 10px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;color: rgb(136, 136, 136);">句子匹配类任务 ( 输入多句 )，Bert采用Fine-tuning效果明显好于特征集成；</span></p></li><li style="color: rgb(136, 136, 136);"><p style="max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;margin-top: 10px;margin-bottom: 10px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;color: rgb(136, 136, 136);">其它类型的任务，在应用Bert的时候，Fine-tuning模式要稍好于特征集成模式，或者两者效果差不多。</span></p></li></ul><h3 data-anchor="22-特征表示" style="box-sizing: content-box;color: rgb(51, 51, 51);font-weight: 700;line-height: 1.7;font-size: 20px;max-width: 100%;"><span style="font-size: 15px;color: rgb(0, 128, 255);"><strong><span style="color: rgb(0, 128, 255);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">2. 特征表示</span></strong></span></h3><p style="margin-top: 25px;margin-bottom: 25px;max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="color: rgb(0, 0, 0);font-family: 微软雅黑;font-size: 15px;letter-spacing: 0.544px;text-indent: 0pt;">这类语言模型都是多层网络拼接，那么我们在使用时，也会有两种特征表示的方法。</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li style="color: rgb(136, 136, 136);"><p style="max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;margin-top: 10px;margin-bottom: 10px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;color: rgb(136, 136, 136);">仅使用最高层的特征</span></p></li><li style="color: rgb(136, 136, 136);"><p style="max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;margin-top: 10px;margin-bottom: 10px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;color: rgb(136, 136, 136);">加权多层的特征</span></p></li></ul><p style="margin-top: 25px;margin-bottom: 25px;max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="color: rgb(0, 0, 0);font-family: 微软雅黑;font-size: 15px;letter-spacing: 0.544px;text-indent: 0pt;">上面的研究给出了下面的结论：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li style="color: rgb(136, 136, 136);"><p style="max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;margin-top: 10px;margin-bottom: 10px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.544px;color: rgb(136, 136, 136);">ELMO在原文中给出了使用的建议，针对不同的任务，使用不同的权重向量加权每一层的特征，并乘上对应的缩放系数。</span></p><p style="max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;margin-top: 10px;margin-bottom: 10px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><img data-ratio="0.15841584158415842" data-src="https://mmbiz.qpic.cn/mmbiz_png/1OAQOBn95MgxnfCakwJfV2ouNictmwzVVKl1M1NDJ7ElketibsXmo2dic5nmic2xfFibe49BttmjkhGhOJDsUSGLX1w/640?wx_fmt=png" data-type="png" data-w="404" style="letter-spacing: 0.544px;box-sizing: border-box;vertical-align: top;border-style: none;line-height: 22.4px;margin-top: 4px;margin-bottom: 10px;cursor: zoom-in;width: 343px;height: 54px;"  /></p></li><li style="color: rgb(136, 136, 136);"><p style="max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;margin-top: 10px;margin-bottom: 10px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.544px;color: rgb(136, 136, 136);">bert在句子匹配等多输入的NLP任务，直接使用最高层特征最简单，效果也最好。</span></p></li><li style="color: rgb(136, 136, 136);"><p style="max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;margin-top: 10px;margin-bottom: 10px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.544px;color: rgb(136, 136, 136);">对于序列标注类任务，可能多层特征融合更适合应用场景。</span></p></li></ul><h2 data-anchor="3-实践" style="margin-top: 25px;max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 2em;text-align: center;margin-bottom: 5px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 50px;color: rgb(0, 128, 255);">04</span></strong></h2><h2 data-anchor="3-实践" style="box-sizing: content-box;color: rgb(51, 51, 51);font-weight: 700;line-height: 1.7;font-size: 22px;border-bottom: none;max-width: 100%;text-align: center;margin-top: 5px;margin-bottom: 25px;"><span style="font-size: 15px;">


&nbsp;
## References
[预训练语言模型在网易严选的应用](https://mp.weixin.qq.com/s/5CuBvw6Z0mPuu5BAR_0p7g)
