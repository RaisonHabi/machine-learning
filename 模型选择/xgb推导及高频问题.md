<h3><b>1. XGB目标函数</b></h3><p>XGBoost的目标函数由<b>训练损失</b>和<b>正则化项</b>两部分组成，目标函数定义如下：</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-849fd4bf2369d9ec91658f56f8d2bcd0_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="264" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic4.zhimg.com/v2-849fd4bf2369d9ec91658f56f8d2bcd0_r.jpg"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;264&#39;&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="264" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic4.zhimg.com/v2-849fd4bf2369d9ec91658f56f8d2bcd0_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-849fd4bf2369d9ec91658f56f8d2bcd0_b.jpg"/></figure><p><b>变量解释：</b></p><p>（1）l 代表损失函数，常见的损失函数有：</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-0e414b2c7c332272ed3b19cf4cfab5c7_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="373" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic1.zhimg.com/v2-0e414b2c7c332272ed3b19cf4cfab5c7_r.jpg"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;373&#39;&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="373" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic1.zhimg.com/v2-0e414b2c7c332272ed3b19cf4cfab5c7_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-0e414b2c7c332272ed3b19cf4cfab5c7_b.jpg"/></figure><p>（2）yi&#39;是第 i 个样本 xi 的预测值。由于XGBoost是一个加法模型，因此，预测得分是每棵树打分的累加之和。 </p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-3dd60fdac0daea38c4fdf2073deaf229_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="281" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic4.zhimg.com/v2-3dd60fdac0daea38c4fdf2073deaf229_r.jpg"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;281&#39;&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="281" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic4.zhimg.com/v2-3dd60fdac0daea38c4fdf2073deaf229_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-3dd60fdac0daea38c4fdf2073deaf229_b.jpg"/></figure><p>（3）将全部k棵树的复杂度进行求和，添加到目标函数中作为正则化项，用于防止模型过度拟合。</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-7db619887491bfe1e0364871e0bbd0e2_b.jpg" data-caption="" data-size="normal" data-rawwidth="734" data-rawheight="216" class="origin_image zh-lightbox-thumb" width="734" data-original="https://pic1.zhimg.com/v2-7db619887491bfe1e0364871e0bbd0e2_r.jpg"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;734&#39; height=&#39;216&#39;&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="734" data-rawheight="216" class="origin_image zh-lightbox-thumb lazy" width="734" data-original="https://pic1.zhimg.com/v2-7db619887491bfe1e0364871e0bbd0e2_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-7db619887491bfe1e0364871e0bbd0e2_b.jpg"/></figure><h3><b>2. 学习第t棵树</b></h3><p>在【1】中提到，XGBoost 是一个加法模型，假设我们第t次迭代要训练的树模型是 ft() ，则有：</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-973039098bce84a437ae9c3b24b53e33_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="191" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic4.zhimg.com/v2-973039098bce84a437ae9c3b24b53e33_r.jpg"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;191&#39;&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="191" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic4.zhimg.com/v2-973039098bce84a437ae9c3b24b53e33_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-973039098bce84a437ae9c3b24b53e33_b.jpg"/></figure><p>将上式带入【1】中的目标函数 Obj ，可以得到：</p><figure data-size="normal"><noscript><img src="https://picb.zhimg.com/v2-efcb16628adc69962efe55d021764edc_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="244" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://picb.zhimg.com/v2-efcb16628adc69962efe55d021764edc_r.jpg"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;244&#39;&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="244" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://picb.zhimg.com/v2-efcb16628adc69962efe55d021764edc_r.jpg" data-actualsrc="https://picb.zhimg.com/v2-efcb16628adc69962efe55d021764edc_b.jpg"/></figure><p>注意上式中，只有一个变量，那就是第 t 棵树：</p><figure data-size="normal"><noscript><img src="https://picb.zhimg.com/v2-6c0d1e6c2d2185ed7a7407f23569fe65_b.png" data-caption="" data-size="normal" data-rawwidth="132" data-rawheight="70" class="content_image" width="132"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;132&#39; height=&#39;70&#39;&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="132" data-rawheight="70" class="content_image lazy" width="132" data-actualsrc="https://picb.zhimg.com/v2-6c0d1e6c2d2185ed7a7407f23569fe65_b.png"/></figure><p>其余的都是已知量或可通过已知量可以计算出来的（注意要理解哦！）。</p><p>细心的同学可以发现，这里我们将正则化项进行了拆分，由于前 t-1棵树的结构已经确定，因此，前 t-1 棵树的复杂度之和可以用一个常量表示：</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-d4671149c84eea4f5101253bcacc7f22_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="218" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic4.zhimg.com/v2-d4671149c84eea4f5101253bcacc7f22_r.jpg"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;218&#39;&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="218" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic4.zhimg.com/v2-d4671149c84eea4f5101253bcacc7f22_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-d4671149c84eea4f5101253bcacc7f22_b.jpg"/></figure><h3><b>3. 泰勒公式展开</b></h3><p>首先简单回忆一下，泰勒公式。</p><blockquote>泰勒公式是将一个在 x = x0 处具有n阶导数的函数 f(x) 利用关于 (x-x0) 的n次多项式来逼近函数的方法。</blockquote><p>泰勒公式的二阶展开形式如下：</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-a6bc6c2248babcf7e5a7d70d14ddb58a_b.png" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="98" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic3.zhimg.com/v2-a6bc6c2248babcf7e5a7d70d14ddb58a_r.jpg"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;98&#39;&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="98" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic3.zhimg.com/v2-a6bc6c2248babcf7e5a7d70d14ddb58a_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-a6bc6c2248babcf7e5a7d70d14ddb58a_b.png"/></figure><p>回到我们的问题上来， f(x) 对应于我们的损失函数 l ，x 对应于前 t-1 棵树的预测值，Δx 对应于我们正在训练的第 t 棵树。 </p><p>首先定义损失函数 l 关于 y‘(t-1) 的<code>一阶偏导数</code>和<code>二阶偏导数</code>：</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-df105cc726910acdb71cd23d9d07354c_b.png" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="98" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic2.zhimg.com/v2-df105cc726910acdb71cd23d9d07354c_r.jpg"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;98&#39;&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="98" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic2.zhimg.com/v2-df105cc726910acdb71cd23d9d07354c_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-df105cc726910acdb71cd23d9d07354c_b.png"/></figure><p>那么，我们的损失函数就可以转化为下式（标出了与泰勒公式中x和Δx的对应关系）。</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-83edbeb939277d20a17a6ca2e49234d8_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="189" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic1.zhimg.com/v2-83edbeb939277d20a17a6ca2e49234d8_r.jpg"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;189&#39;&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="189" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic1.zhimg.com/v2-83edbeb939277d20a17a6ca2e49234d8_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-83edbeb939277d20a17a6ca2e49234d8_b.jpg"/></figure><p>将上述二阶展开式，带入到【2】中的目标函数 Obj 中，可以得到目标函数 Obj 的近似值：</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-babc7befe614b1aac79e7e8e3ac68fb7_b.png" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="76" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic3.zhimg.com/v2-babc7befe614b1aac79e7e8e3ac68fb7_r.jpg"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;1080&#39; height=&#39;76&#39;&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="76" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic3.zhimg.com/v2-babc7befe614b1aac79e7e8e3ac68fb7_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-babc7befe614b1aac79e7e8e3ac68fb7_b.png"/></figure><p>去掉全部常数项，得到目标函数：</p>

&nbsp;
## reference
[XGBoost、GBDT超详细推导](https://zhuanlan.zhihu.com/p/92837676)  
[20道XGBoost面试题](https://mp.weixin.qq.com/s?__biz=MzI1MzY0MzE4Mg==&mid=2247485159&idx=1&sn=d429aac8370ca5127e1e786995d4e8ec&chksm=e9d01626dea79f30043ab80652c4a859760c1ebc0d602e58e13490bf525ad7608a9610495b3d&scene=21#wechat_redirect) 
