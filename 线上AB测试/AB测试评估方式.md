评估报告的可靠和权威性主要体现在两个方面：一是评估指标的可靠性和权威性；二是评估方式的科学性。  
在上一节中我们重点讨论了如何构建可靠权威的指标体系，在这一节我们重点讨论如何进行科学的评估。  

在讨论科学评估之前，再重温一下A/B实验的定义：A/B实验，简单来说，就是为同一个目标制定两个版本或多个版本的方案，在同一时间维度，分别让组成成分相同（相似）的A/B群组分别采用这些版本，收集各群组的体验数据和业务数据，最后分析、评估出最好版本，正式采用。  
其中A方案为现行的设计（称为控制组）， B方案是新的设计（称为实验组）。  

分析A/B实验的定义，要实现科学权威的评估，最重要的两点在于：  
> 第一，确保在实验前分出无差别的实验组和对照组，避免因流量分配不平衡导致的AB群组差异过大，最终造成对于实验结果的误判；  
第二，确保对实验结果作出准确的判断，能够准确的判断新策略相对于旧策略的优势是不是自然波动引起的，它的这一优势能否在大规模的推广中反映出来。

无论是实验前确保实验组和对照组流量的无显著性差异，还是实验后新策略较旧策略的指标变动是否具有统计显著性，无一例外都蕴含着统计学知识，接下来重点论述一下A/B实验所依赖的统计学基础以及如何依据统计学理论做科学评估。

&nbsp;
## 假设检验
### 两个假设
A/B测试是一种对比试验，我们圈定一定的流量进行实验，实验结束后，我们基于实验样本进行数据统计，进而验证实验前假设的正确性，我们得出这一有效结论的科学依据便是假设检验。

**假设检验是利用样本统计量估计总体参数的方法**，在假设检验中，**先对总体均值提出一个假设**，然后用样本信息去检验这个假设是否成立。  
我们把提出的这个假设叫做原假设，与原假设对立的结论叫做备择假设，如果原假设不成立，就要拒绝原假设，进而接受备择假设。
### 两类错误
对于原假设提出的命题，我们需要作出判断，要么原假设成立，要么原假设不成立，  
因为是基于样本对总体的推断，会面临着犯两种错误的可能：  
> 第一类错误，原假设为真，我们却拒绝了；  
第二类错误，原假设为伪，我们却接受了。 

自然，我们希望犯这两类错误的概率越小越好，但对于一定的样本量n，不能同时做到犯这两类错误的概率很小。在假设检验中，就有一个对两类错误进行控制的问题，一般来说，哪一类错误所带来的后果严重，危害越大在假设检验中就应该把哪一类错误作为首要的控制目标。在假设检验中我们都执行这样一个原则首先控制犯第一类错误的概率，这也是为什么我们在实际应用中会把要推翻的假设作为原假设，这样得出的结论更具说服力（我们有足够充分的证据证明原来确定的结论是错误的），所以通常会看到我们把要证明的结论作为备择假设。
### T检验
常见的假设检验方法有Z检验、T检验和卡方检验等，不同的方法有不同的适用条件和检验目标。  
Z检验和T检验都是用来推断两个总体均值差异的显著性水平，具体选择哪种检验由样本量的大小、总体的方差是否已知决定。在样本量较小且总体的方差未知的情况下，这时只能使用样本方差代替总体方差，样本统计量服从T分布，应该采用T统计量进行检验。T统计量具体构造公式如下图所示，其中f是T统计量的自由度，S1、S2是样本标准差。

T检验的流程是，在给定的弃真错误概率下（一般取0.05），依据样本统计量T是否落在拒绝域来判断接受还是拒绝原假设。实际上在确定弃真错误概率以后，拒绝域的位置也就相应确定了。使用T统计量进行判断的好处是，进行决策的界限清晰，但缺陷是决策面临的风险是笼统的，例如T=3落入拒绝域，我们拒绝原假设，犯弃真错误的概率为0.05；T=2也落入拒绝域，我们拒绝原假设，犯弃真错误的概率也是0.05。事实上，依据不同的统计量进行决策，面临的风险是有差别的，为了精确的反映决策的风险度，仍然需要P值来帮助业务做决策。

### 利用P值决策
P值即统计功效函数，当原假设为真时，所得到的样本观察结果或更极端的结果出现的概率。如果P值很小，说明这种情况发生的概率很小，但是在这次试验中却出现了，根据小概率原理，我们有理由拒绝原假设，P值越小，我们拒绝原假设的理由越充分。P值可以理解为犯弃真错误的概率，在确定的显著性水平下（一般取0.05），P值小于显著性水平，则拒绝原假设。

&nbsp;
## 基于假设检验的科学评估
围绕着科学评估要解决的两个问题，实验前，针对圈定的流量使用假设检验加上动态规划算法，确保分出无差别的实验组和对照组；实验后，基于实验前选定的用于验证假设结论的指标，构造T统计量并计算其对应的P值，依据P值帮我们做决策。

###  AA分组
首先看如何解决第一个问题：避免因流量分配不平衡，A/B组本身差异过大造成对实验结果的误判。为解决该问题我们引入了AA分组：基于实验者圈定的流量，通过AA分组将该流量分为无显著性差异的实验组和对照组。我们这样定义无显著性差异这一约束：首先，实验者选取的用于刻画实验流量的指标在实验组和对照组之间无统计上的显著性（即上节所描述的基于均值的假设检验）；其次，在所分出的实验组和对照组之间，这些指标的差值最小，即一个寻找最优解的过程。从实验者的实验流程看，在实验前，圈定进入该实验的流量，然后确定用于刻画实验流量的指标，最后调用AA分组，为其将流量分成合理的实验组和对照组。

### A/B效果评估
A/B效果评估是实验者在实验后，依据评估报告进行决策的重要依据， 因此在实验后的效果评估环节，我们的效果评估要达成三个目标，即权威、灵活和方便。首先，权威性体现在用于作出实验结论所依赖的指标都是经过治理、各方达成一致的指标，并且确保数据一致性，最终通过假设检验给出科学的实验结论，帮助实验者作出正确判断。其次，灵活性主要体现在采用列转行的形式，按需自动生成报表告别烟囱式的报表开发方式。第三，方便主要体现在不仅可以查看用于说明实验效果的指标，还可以选择查看接入到评估体系里的任意指标；不仅可以查看其实验前后对比以及趋势变化，还可以做到从实验粒度到流量实体粒度的小钻，如下图所示。

### 技术实现
不管是实验前的AA分组还是实验后的效果评估，我们要解决的一个核心问题就是如何灵活“取数”，为我们的AA分组和AB效果分析提供一个灵活稳定的取数服务。因此我们整个架构的核心就是构建稳定灵活的取数服务，具体架构如下图所示。离线建模和指标模型管理完成数据和元数据建设，建立权威完备的指标体系；中间的取数服务作为上层各应用服务和指标体系的桥梁，为上层各应用服务提供其所依赖的指标。
