## 概念定义
增益模型（uplift model）定义：一种用于估算个体干预增量（uplift）的模型，即干预动作（treatment）对用户响应行为（outcome）产生的效果。

这是一个因果推断（Causal Inference) 课题下估算ITE（Individual Treatment Effect）的问题——估算同一个体在干预与不干预（互斥情况下）不同outcome的差异。为了克服这一反事实的现状，增益模型强依赖于随机实验（将用户随机分配到实验组&对照组）的结果数据。  
CATE 和 ITE（Individual Treatment Effect）可以认为是一个概念。

#### 挑战：数据不完整/反事实，对于单个用户来说，不可能同时观测到在有干预(发券)和没有干预(不发券)两种情况下的表现，这也是因果推断中的反事实的问题；
#### 解决方案：随机化实验 ，如AB实验

详见 [阿里文娱智能营销增益模型 ( Uplift Model ) 技术实践](https://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247498630&idx=1&sn=b36515e54c2dbc20186942102497c390&chksm=fbd749eacca0c0fc9e285ffc7d06e336115f387394362a4707c71377f02832f8c42bcc71cc7a&mpshare=1&scene=24&srcid=&sharer_sharetime=1585109170232&sharer_shareid=255a68ecb152bdfa3b164d51ce560a8d#rd)

[增益模型（Uplift Model）的基础介绍 —— 估算ITE](https://zhuanlan.zhihu.com/p/425898510)

## 背景
1、假设电商平台一件标价300元的商品，用户的购买率为6%。现有一批预算可以给用户发放10元的优惠券以提升用户购买率。需要给每个用户都发放优惠券吗？答案显然是否定，那么这批优惠券应该发送给平台的哪些用户呢？  
此时我们脑海中有四类用户：  
> Persuadables：不发送优惠券则不买，发送优惠券则购买；  
Sure things：不论是否发送优惠券均会购买；  
Lost causes: 不论是否发送优惠券均不会购买；  
Sleeping Dogs: 不发送优惠券会购买，发送优惠券反而不买

Uplift模型要解决的问题就是通过建模预测的方法精准的去对这四类用户进行分群。  

2、Response Model很有可能会误导我们做出错误的决策，Uplift Model和Response Model之所以有差异，主要在于两个模型的预测目标不一样。
> Response Model的目标是估计用户看过广告之后转化的概率，这本身是一个相关性，但这个相关性会导致我们没有办法区分出自然转化人群；  
Uplift Model是估计用户因为广告而购买的概率，这是一个因果推断的问题，帮助我们锁定对营销敏感的人群。所以Uplift Model是整个智能营销中非常关键的技术，预知每个用户的营销敏感程度，从而帮助我们制定营销策略，促成整个营销的效用最大化。

## 建模方法
### 1、Two-Learner
Two-Learner是基于双模型的差分模型，我们对实验组(有干预)和对照组(无干预)的购买行为进行分别建模，然后用训练所得两个模型分别对全量用户的购买行为进行预测，此时一个样本用户即可得出有干预和无干预情况下两个购买行为预测值。这两个预测值的差就是我们想要的uplift score。

这种建模方法较简单且易于理解，可以直接用回归、GBDT等模型实现。但也存在一些局限性：
```
对照组和实验组分别建模，两个模型完全隔离，可能两个模型各有偏差从而导致预测的误差较大。
其次建模的目标是Response而不直接是Uplift，因此模型对Uplift的预测能力较有限；

策略只能是离散值，不能是连续变量，因为有几种策略就需要建几个模型。
所以当干预条件只有‘是否发优惠券’时，此建模方法可行，但是当涉及到‘多种优惠券面额/文案组合策略’或者‘发多大面额优惠券这种连续变量策略’时，本种建模方法可能并不非常work；
```
### 2、Single-Learner
Single-Learner在Two-Learner的基础上，将对照组数据和实验组数据放在一起建模，使用一个模型对处理效果进行估计，然后计算该样本用户进入实验组和对照组模型预测的差异作为对实验影响的估计。

与Two-Learner不同的是，本模型将实验分组（干预项）作为一个单独特征和其他变量一起放入模型中对用户购买行为进行建模，干预项可以是多种组合策略或者连续变量。

训练样本共用可以使此模型学习更加充分，通过单个模型的学习也可以避免双模型打分累积误差较大的问题。此外模型可以支持干预项为多策略及连续变量的建模，实用性较强。但此模型在本质上依然还是对Response建模，对Uplift的预测还是比较间接。
### 3、Class Transformation Method
Class Transformation Method模型既可以将实验组与对照组数据打通，同时它又是直接对Uplift score进行预测，计算用户在实验组中购买概率与在对照组中购买概率的差值，其核心思想是将实验组和控制组样本混合并创建新的变量z满足：
> 当用户在实验组(发券)且用户最终购买时，z=1  
当用户在对照组(无干预)且用户最终未购买时，z=1  
当用户在实验组(发券)且用户最终未购买时，z=0  
当用户在对照组(无干预)且用户最终购买时，z=0

可以证明，P(Z=1│Xi) 和Uplift Score是线性正相关的，且当实验组与控制组样本比例为1:1时，Uplift Score =2P(Z=1│Xi)-1，目标从预测Uplift Score转化为了预测P(Z=1│Xi)

## Uplift模型评估
根据Uplift Score的定义，分数越高的用户即所谓的营销增益就越大。增益模型由于不能同时观测同用户在不同干预项下的真实增量，通常是通过划分十分位数来观测实验组用户和对照组用户样本来进行间接评估。
### 1、Uplift 十分位柱状图
将测试集预测出的用户按照Uplift Score由高到低平均分为10组，分别是top 10%用户，top 20%用户……top 100%用户。分别对每个十分位内的用户求实验组和对照组预测分数的均值，然后相减，计算不同分段中真正的实验提升收益。然后根据每个分组得出的实验收益，绘制十分位柱状图。这样，即可较直观观察到有多少的用户大概可以获得多少的营销增益。

### 2、qini曲线(qini curve)
计算每组用户百分比的qini系数，将这些系数连接起来，得到一条qini曲线

## 实现示例
详见 [智能营销模型-Uplift Model详解及Python使用](https://blog.csdn.net/u010654299/article/details/122795833)  

## 总结
总结一下Uplift模型可能的应用场景：
> 精准定位策略敏感人群：如全文所述，我们希望找出来一些对干预项（例如发券、投放等）比较敏感的用户，继而对其进行精准策略/营销；  
测算收益空间：Uplift模型可以帮助我们测算如果对策略做一些人群向优化，业务收益将会提升多少

## references
[该把优惠券发送给哪些用户？一文读懂Uplift模型](https://mp.weixin.qq.com/s/xmiMi7JPDwG5r0BP8QDI-A)  
[阿里文娱智能营销增益模型 ( Uplift Model ) 技术实践](https://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247498630&idx=1&sn=b36515e54c2dbc20186942102497c390&chksm=fbd749eacca0c0fc9e285ffc7d06e336115f387394362a4707c71377f02832f8c42bcc71cc7a&mpshare=1&scene=24&srcid=&sharer_sharetime=1585109170232&sharer_shareid=255a68ecb152bdfa3b164d51ce560a8d#rd)  
[智能营销模型-Uplift Model详解及Python使用](https://blog.csdn.net/u010654299/article/details/122795833)  
[Hands-on DataScience](https://www.zhihu.com/column/c_1386046341714444288)

